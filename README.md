# MoreApp Java Starter Kit

An example project to help MoreApp partners with their first usage of the API.

## Run example for accessing the API

```
./gradlew runExample
```

## Example code

Check out the file `src/main/java/com/moreapp/starterkit/Example.java` to see interaction with the API.

The example code reads a properties file from disk.

```
Properties properties = new Properties();
properties.load(Example.class.getResourceAsStream(...));
```

It sets up a client with authorization settings (using the loaded properties file).

```
OAuthRestTemplate oAuthRestTemplate = prepareClient(properties);
```

The client can be used to make an authorized call to the MoreApp API. The example code will fetch all customers for the authorized partner.

```
ResponseEntity<Map[]> response = oAuthRestTemplate.getForEntity(endpoint + "/customers", Map[].class);
System.out.println("The response status is: " + response.getStatusCode());
if (response.getStatusCode().value() != 200) {
    System.out.printf("Something went wrong please check the credentials and the API endpoint");
    return;
}
```

Finaly the code will output the result.

```
System.out.println("The customers are:");
Map[] customers = response.getBody();
for (Map customer : customers) {
    System.out.println(" - " + customer.get("name"));
}
```

## Changing the example for your own usage

To use the example for your own usage change the file `src/main/resources/com/moreapp/starterkit/api.properties`.

- The `endpoint` should be `https://api.moreapp.com/api/v1.0`.
- The `consumerKey` and `consumerSecret` properties should be changed into the correct partner credentials.


## Run hook web service example

```
./gradlew runHookWebService
```

From another terminal, install Node from https://nodejs.org/ and then run
```
npm install -g localtunnel
lt --port 3000 --subdomain hookwebservice
```
This will allow MoreApp to access the locally running Hook Web Service using the URL http://hookwebservice.localtunnel.me/


## Example code

Check out the file `src/main/java/com/moreapp/starterkit/hook/HookWebService.java` to see how the web service works.
There are three endpoints:

- /test

    Called by MoreApp to test a configuration, after configuring a Hook on a Form.

- /health

    Called by MoreApp to test the endpoint is running and available.

- /handle

    Called by MoreApp after a registration for a form is received and this Hook is configured for that Form.
    This endpoint gets the actual registration sent in the request.
    Using the Seal in the request, the Hook can perform operations on the MoreApp platform for this particular registration.
    The Seal needs to be the header 'X-MORE-SEAL' in the request for that operation. Operations are limited to the permissions in the definition.json of the Hook.
    See the `src/main/resources/hook/definition.json` for the definition of the Hook in MoreApp.
    The `definition.json` needs to be zipped into a file and then uploaded using the [Developer portal](https://developer.moreapp.com).

    The example code will download all PDF files generated by the Email Trigger of the Form and save them as registration-file-{pdfFileId}.pdf.

## Changing the example for your own usage

To use the example for your own usage change the file `src/main/resources/com/moreapp/starterkit/api.properties`.

- The `endpoint` should be `https://api.moreapp.com/api/v1.0`. For the example we use the MoreApp develop environment. Please do not use this.
